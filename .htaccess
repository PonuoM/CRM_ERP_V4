<IfModule mod_rewrite.c>
  Options -MultiViews
  RewriteEngine On

  # The app is deployed under /mini_erp
  RewriteBase /mini_erp/

  # 1) Allow API requests to pass through to /api
  RewriteRule ^api/ - [L]

  # 2) Serve existing files/directories in this folder as-is
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # 3) For non-API requests not already under /dist,
  #    rewrite to /dist/<path> so built assets are served
  RewriteRule ^(?!dist/|api/)(.*)$ dist/$1 [QSA,L]

  # 4) SPA fallback: for anything under /dist that is not a real file/dir,
  #    serve /dist/index.html so client-side routing works
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^dist/.* dist/index.html [L]
</IfModule>

# Ensure the default document is the built index.html
DirectoryIndex dist/index.html

# Optional: cache static assets aggressively
<IfModule mod_headers.c>
  <FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|ico|woff2?|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>

