# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á Collation ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô utf8mb4_unicode_ci

## üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
- **utf8mb4_0900_ai_ci**: 158 columns ‡πÉ‡∏ô 36 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà)
- **utf8mb4_unicode_ci**: 95 columns ‡πÉ‡∏ô 30 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏™‡πà‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢)

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô `utf8mb4_unicode_ci` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠

## ‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

**‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á BACKUP ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ô Migration!**

```bash
# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£ backup
mysqldump -u root -p mini_erp > backup_before_collation_migration_$(date +%Y%m%d_%H%M%S).sql
```

## üöÄ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

```bash
php migrations/verify_all_unicode_ci.php
```

‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á/columns ‡πÑ‡∏´‡∏ô‡πÉ‡∏ä‡πâ collation ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏±‡∏ô Migration (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ PHP script)

```bash
php migrations/20250201_convert_all_to_utf8mb4_unicode_ci_v2.php
```

**PHP Script ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞:**
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á progress ‡πÅ‡∏ö‡∏ö real-time
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ errors ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
- ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• FK ‡πÅ‡∏•‡∏∞ recreate ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

```bash
php migrations/verify_all_unicode_ci.php
```

‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
```
‚úÖ ALL COLLATIONS ARE utf8mb4_unicode_ci!
```

## üìù ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà Migration Script ‡∏à‡∏∞‡∏ó‡∏≥

1. **‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Foreign Keys** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
2. **Drop Foreign Keys** ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error)
3. **‡πÅ‡∏õ‡∏•‡∏á Table Default Collation** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
4. **‡πÅ‡∏õ‡∏•‡∏á Column Collations** ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ `utf8mb4_0900_ai_ci`
5. **Recreate Foreign Keys** ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
6. **‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•**

## ‚è±Ô∏è ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?

‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡πá‡∏Å (< 100MB): ~1-2 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á (100MB - 1GB): ~5-10 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏ç‡πà (> 1GB): ~10-30 ‡∏ô‡∏≤‡∏ó‡∏µ

## üîç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á

```sql
-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ utf8mb4_0900_ai_ci ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
SELECT COUNT(*) as remaining_tables
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = DATABASE()
  AND TABLE_TYPE = 'BASE TABLE'
  AND TABLE_COLLATION = 'utf8mb4_0900_ai_ci';
-- ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ 0

-- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ columns ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ utf8mb4_0900_ai_ci ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
SELECT COUNT(*) as remaining_columns
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = DATABASE()
  AND COLLATION_NAME = 'utf8mb4_0900_ai_ci';
-- ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ 0
```

## ‚ùì FAQ

### Q: Migration ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
**A:** ‡πÑ‡∏°‡πà‡∏•‡∏ö! ‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô collation ‡∏Ç‡∏≠‡∏á table/column ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö

### Q: ‡∏ñ‡πâ‡∏≤ migration fail ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏±‡∏ô?
**A:** PHP script ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á error message ‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà

### Q: ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î application ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
**A:** ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î application ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏Ç‡∏ì‡∏∞‡∏£‡∏±‡∏ô migration ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô conflict

### Q: Migration ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
**A:** ‡πÑ‡∏î‡πâ! ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°

### Q: ‡∏à‡∏∞‡∏°‡∏µ downtime ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
**A:** ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
- ‡πÄ‡∏•‡πá‡∏Å/‡∏Å‡∏•‡∏≤‡∏á: ‡∏≠‡∏≤‡∏à‡∏°‡∏µ downtime ‡∏™‡∏±‡πâ‡∏ô‡πÜ 1-5 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡πÉ‡∏´‡∏ç‡πà: ‡∏≠‡∏≤‡∏à‡∏°‡∏µ downtime 10-30 ‡∏ô‡∏≤‡∏ó‡∏µ

## üõ†Ô∏è Alternative: ‡πÉ‡∏ä‡πâ SQL Script (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ SQL script ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:

```bash
mysql -u root -p mini_erp < migrations/20250201_convert_all_to_utf8mb4_unicode_ci.sql
```

**‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** SQL script ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ foreign keys ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ PHP script ‡πÅ‡∏ó‡∏ô

## üìû ‡∏™‡∏£‡∏∏‡∏õ

1. ‚úÖ Backup ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô
2. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: `php migrations/verify_all_unicode_ci.php`
3. ‚úÖ ‡∏£‡∏±‡∏ô migration: `php migrations/20250201_convert_all_to_utf8mb4_unicode_ci_v2.php`
4. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•: `php migrations/verify_all_unicode_ci.php`

**‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å migration ‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏∏‡∏Å table ‡πÅ‡∏•‡∏∞ column ‡∏à‡∏∞‡πÉ‡∏ä‡πâ `utf8mb4_unicode_ci` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î!** üéâ

