---
description: คู่มืออธิบายการทำงานระบบติดตามหนี้ (Debt Collection)
---

# คู่มือการใช้งานระบบติดตามหนี้ (Debt Collection)

ระบบติดตามหนี้ออกแบบมาเพื่อช่วยติดตามออเดอร์ที่ยังไม่ได้รับชำระเงิน (Unpaid) หรือออเดอร์ที่มีปัญหา โดยเน้นการติดตามยอด COD หรือ PayAfter

## 1. การเข้าถึง
- เมนู "ติดตามหนี้" (Debt Collection)

## 2. โครงสร้างหน้าจอ
หน้าจอแบ่งออกเป็น 2 แท็บหลัก:
1.  **กำลังติดตาม (Active)**: แสดงรายการออเดอร์ที่ **ยังติดตามไม่สำเร็จ** (Unpaid) หรือออเดอร์ที่เป็น **หนี้สูญ (Bad Debt)**
2.  **จบเคสแล้ว / จ่ายครบ (Completed)**: แสดงรายการที่ติดตามสำเร็จ (Paid / Partial Paid) หรือจบเคสด้วยเหตุผลอื่น รวมถึง **หนี้สูญ (Bad Debt)**

## 3. การค้นหาและตัวกรอง (Filters)
- **ค้นหา**: รองรับการค้นหาด้วย ชื่อลูกค้า, เบอร์โทร, หรือ Order ID
- **ช่วงวันที่ส่ง (Date Range)**: เลือกช่วงเวลาของ "วันที่จัดส่ง" โดยใช้ปฏิทินแบบช่วง (Date Range Picker)
- **ค้างชำระ (วัน)**: กรองตามจำนวนวันที่เกินกำหนด (เช่น เกิน 3, 7, 15, 30 วัน)
- **สถานะการติดตาม**: กรองว่าออเดอร์นี้ "เคยติดตามแล้ว" หรือ "ยังไม่เคยติดตาม"

## 4. สัญลักษณ์และสถานะ
- **หนี้สูญ (Bad Debt)**: แสดง Badge สีแดงคำว่า "หนี้สูญ" ใต้ Order ID หากออเดอร์นั้นถูกระบุว่าเป็นหนี้สูญ
- **จำนวนครั้งที่ติดตาม**: แสดงจำนวนครั้งที่เคยบันทึกการติดตาม
- **ยอดตามได้**: แสดงยอดเงินรวมที่เก็บได้จากออเดอร์นั้น

## 5. การดำเนินการ (Actions)

### 5.1 การบันทึกการติดตาม (Track)
กดปุ่ม **"ติดตาม"** เพื่อเปิดหน้าต่างบันทึกข้อมูล
- **Order Info**: แสดงรายละเอียดลูกค้าและยอดหนี้คงเหลือ
- **ประวัติการติดตาม (History)**: แสดงรายการติดตามครั้งก่อนๆ (สามารถลบประวัติที่ผิดพลาดได้ที่ไอคอนถังขยะ)
- **แบบฟอร์มบันทึก**:
    - **ผลการติดตาม**:
        - **เก็บไม่ได้**: ติดต่อไม่ได้ หรือลูกค้าไม่ยอมจ่าย (จะไม่สามารถอัปโหลดสลิปได้)
        - **เก็บได้บางส่วน**: ลูกค้าจ่ายมาบางส่วน (ต้องระบุยอดและธนาคารของแต่ละสลิป)
        - **เก็บได้ทั้งหมด**: ลูกค้าจ่ายครบ
    - **ยอดเงินที่เก็บได้**: 
        - คำนวณอัตโนมัติจากผลรวมของยอดแต่ละสลิปที่อัปโหลด
        - กรณีรับเงินสด (ไม่อัปโหลดสลิป) สามารถระบุยอดรวมได้โดยตรง
    - **บันทึกเพิ่มเติม (Note)**: รายละเอียดการพูดคุย หรือนัดหมาย
    - **รูปภาพหลักฐาน (สลิป)**: 
        - *แสดงเฉพาะเมื่อเลือกสถานะ "เก็บได้บางส่วน" หรือ "เก็บได้ทั้งหมด"*
        - รองรับการอัปโหลดหลายรูปภาพพร้อมกัน
        - **แต่ละรูปต้องระบุ**:
            1. **ยอดเงิน**: จำนวนเงินตามสลิป
            2. **ธนาคาร**: เลือกบัญชีที่โอนเข้า (แสดงเป็น "ชื่อธนาคาร - เลขที่บัญชี")
    - **ต้องการจบเคสนี้ทันที (Close Case)**:
        - ติ๊กเมื่อต้องการปิดงานติดตามนี้ (ย้ายไปแท็บ Completed)
        - **เป็นหนี้สูญ (Bad Debt)**: (ปรากฏเมื่อติ๊กจบเคส) เลือกเมื่อต้องการระบุว่าหนี้นี้สูญ ระบบจะปรับสถานะออเดอร์เป็น `BadDebt`

## 6. ลอจิกการทำงาน (System Logic)
- **Active Tab**:
    - แสดงออเดอร์ที่ยังไม่มีการ "จบเคส" (is_complete = 0)
    - **ยกเว้น**: ออเดอร์ที่เป็น `BadDebt` จะไม่แสดงในหน้านี้ (ย้ายไปหน้า Completed ตามอัปเดตล่าสุด) หรือแสดงตามเงื่อนไขที่กำหนด
    - *Update*: ปัจจุบันรายการ `BadDebt` ถูกย้ายไปแสดงในแท็บ **Completed** เพื่อให้หน้า Active เหลือเฉพาะรายการที่ต้องติดตามต่อจริงๆ
- **Completed Tab**:
    - แสดงออเดอร์ที่มีประวัติการ "จบเคส" (is_complete = 1)
    - แสดงออเดอร์ที่เป็น `BadDebt`
    - สามารถกด "ติดตาม" เพื่อดูประวัติย้อนหลังหรือแก้ไขสถานะได้ (แต่ไม่มีปุ่มยกเลิกการจบเคส)

## 7. ไฟล์ที่เกี่ยวข้อง
- `pages/DebtCollectionPage.tsx`: หน้าจอหลัก
- `components/DebtCollectionModal.tsx`: หน้าต่างบันทึกและประวัติ
- `api/Finance/get_debt_collection_orders.php`: API ดึงรายการออเดอร์
- `api/Finance/debt_collection.php`: API บันทึก/แก้ไข/ลบ ประวัติการติดตาม
